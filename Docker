FROM python:3.10-slim

# Set working directory
WORKDIR /app

# Install git and other dependencies
RUN apt-get update && \
    apt-get install -y git && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Copy the script to the container
COPY github_to_text.py /app/

# Create a directory for output
RUN mkdir -p /app/output

# Make the script executable
RUN chmod +x /app/github_to_text.py

# Create entrypoint script for easier usage
RUN echo '#!/bin/bash\n\
# Default to help if no arguments\n\
if [ $# -eq 0 ]; then\n\
  python /app/github_to_text.py --help\n\
  exit 0\n\
fi\n\
\n\
# Run the script with the provided arguments\n\
python /app/github_to_text.py "$@"' > /app/entrypoint.sh && \
    chmod +x /app/entrypoint.sh

# Set the entrypoint
ENTRYPOINT ["/app/entrypoint.sh"]

# Set default output directory to mounted volume
VOLUME ["/app/output"]

# Set workdir to the output volume
WORKDIR /app/output

# Documentation
LABEL maintainer="User <user@example.com>"
LABEL version="1.0"
LABEL description="Docker container for converting GitHub repositories to text format for LLM ingestion"